<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Toko Buah ABG - Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Poppins', sans-serif;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-green-50 to-yellow-50 min-h-screen">
    
    <!-- Header -->
    <header class="bg-gradient-to-r from-green-600 to-yellow-500 text-white shadow-lg">
        <div class="container mx-auto px-4 py-6">
            <h1 class="text-4xl font-bold">üçé Toko Buah ABG</h1>
            <p class="text-green-100 mt-2">Dashboard Manajemen Produk Buah Segar</p>
        </div>
    </header>

    <div class="container mx-auto px-4 py-8">
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            
            <!-- Form Section -->
            <div class="lg:col-span-1">
                <div class="bg-white rounded-2xl shadow-xl p-6 sticky top-4">
                    <h2 class="text-2xl font-bold text-gray-800 mb-4 flex items-center">
                        <span id="formTitle">‚ûï Tambah Buah</span>
                    </h2>
                    
                    <form id="fruitForm" class="space-y-4">
                        <input type="hidden" id="editIndex" value="">
                        
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">Nama Buah</label>
                            <input type="text" id="name" required 
                                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent transition"
                                placeholder="Contoh: Apel Fuji">
                        </div>

                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">Harga (Rp)</label>
                            <input type="number" id="price" step="0.01" required 
                                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent transition"
                                placeholder="15000">
                        </div>

                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">Deskripsi</label>
                            <textarea id="description" rows="3" 
                                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent transition"
                                placeholder="Deskripsi buah..."></textarea>
                        </div>

                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">Pajak (%)</label>
                            <input type="number" id="tax" step="0.01" 
                                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent transition"
                                placeholder="10">
                        </div>

                        <div class="flex gap-2">
                            <button type="submit" id="submitBtn"
                                class="flex-1 bg-gradient-to-r from-green-600 to-yellow-500 text-white px-6 py-3 rounded-lg font-semibold hover:shadow-lg transform hover:-translate-y-0.5 transition">
                                Tambah Buah
                            </button>
                            <button type="button" id="cancelBtn" onclick="cancelEdit()" 
                                class="hidden px-6 py-3 bg-gray-500 text-white rounded-lg font-semibold hover:bg-gray-600 transition">
                                Batal
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Table Section -->
            <div class="lg:col-span-2">
                <div class="bg-white rounded-2xl shadow-xl p-6">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-2xl font-bold text-gray-800">üì¶ Daftar Buah</h2>
                        <button onclick="loadItems()" 
                            class="bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600 transition text-sm font-semibold">
                            üîÑ Refresh
                        </button>
                    </div>

                    <div id="itemsContainer" class="overflow-x-auto">
                        <div class="text-center py-8 text-gray-500">
                            <p class="text-lg">Memuat data...</p>
                        </div>
                    </div>
                </div>

                <!-- Statistics -->
                <div class="grid grid-cols-3 gap-4 mt-6">
                    <div class="bg-gradient-to-br from-green-500 to-green-600 text-white rounded-xl p-6 shadow-lg">
                        <p class="text-sm opacity-90">Total Produk</p>
                        <p id="totalItems" class="text-3xl font-bold mt-2">0</p>
                    </div>
                    <div class="bg-gradient-to-br from-yellow-500 to-orange-500 text-white rounded-xl p-6 shadow-lg">
                        <p class="text-sm opacity-90">Harga Tertinggi</p>
                        <p id="maxPrice" class="text-3xl font-bold mt-2">Rp 0</p>
                    </div>
                    <div class="bg-gradient-to-br from-blue-500 to-purple-500 text-white rounded-xl p-6 shadow-lg">
                        <p class="text-sm opacity-90">Harga Terendah</p>
                        <p id="minPrice" class="text-3xl font-bold mt-2">Rp 0</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Notification -->
    <div id="toast" class="fixed top-4 right-4 bg-green-600 text-white px-6 py-4 rounded-lg shadow-xl hidden transform transition-all duration-300">
        <p id="toastMessage" class="font-semibold"></p>
    </div>

    <script>
        const API_URL = 'http://127.0.0.1:8000';

        // Load items on page load
        window.onload = () => {
            loadItems();
        };

        // Show toast notification
        function showToast(message, isError = false) {
            const toast = document.getElementById('toast');
            const toastMessage = document.getElementById('toastMessage');
            toastMessage.textContent = message;
            toast.className = `fixed top-4 right-4 ${isError ? 'bg-red-600' : 'bg-green-600'} text-white px-6 py-4 rounded-lg shadow-xl transform transition-all duration-300`;
            toast.classList.remove('hidden');
            setTimeout(() => {
                toast.classList.add('hidden');
            }, 3000);
        }

        // Load all items
        async function loadItems() {
            try {
                const response = await axios.get(`${API_URL}/items`);
                displayItems(response.data);
                updateStatistics(response.data);
            } catch (error) {
                showToast('Gagal memuat data. Pastikan server berjalan!', true);
                document.getElementById('itemsContainer').innerHTML = 
                    '<div class="text-center py-8 text-red-500"><p class="text-lg">‚ùå Gagal memuat data</p><p class="text-sm mt-2">Pastikan server FastAPI berjalan di http://127.0.0.1:8000</p></div>';
            }
        }

        // Display items in table
        function displayItems(items) {
            const container = document.getElementById('itemsContainer');
            
            if (items.length === 0) {
                container.innerHTML = '<div class="text-center py-8 text-gray-500"><p class="text-lg">üì≠ Belum ada buah yang ditambahkan</p></div>';
                return;
            }

            let html = `
                <table class="w-full">
                    <thead class="bg-gradient-to-r from-green-600 to-yellow-500 text-white">
                        <tr>
                            <th class="px-4 py-3 text-left rounded-tl-lg">No</th>
                            <th class="px-4 py-3 text-left">Nama Buah</th>
                            <th class="px-4 py-3 text-left">Harga</th>
                            <th class="px-4 py-3 text-left">Deskripsi</th>
                            <th class="px-4 py-3 text-left">Pajak</th>
                            <th class="px-4 py-3 text-center rounded-tr-lg">Aksi</th>
                        </tr>
                    </thead>
                    <tbody class="divide-y divide-gray-200">
            `;

            items.forEach((item, index) => {
                const totalPrice = item.tax ? item.price * (1 + item.tax / 100) : item.price;
                html += `
                    <tr class="hover:bg-gray-50 transition">
                        <td class="px-4 py-4 font-semibold text-gray-700">${index + 1}</td>
                        <td class="px-4 py-4 font-semibold text-gray-800">üçé ${item.name}</td>
                        <td class="px-4 py-4">
                            <span class="text-green-600 font-bold">Rp ${item.price.toLocaleString('id-ID')}</span>
                            ${item.tax ? `<br><span class="text-xs text-gray-500">Total: Rp ${totalPrice.toLocaleString('id-ID')}</span>` : ''}
                        </td>
                        <td class="px-4 py-4 text-gray-600 text-sm">${item.description || '-'}</td>
                        <td class="px-4 py-4 text-gray-600">${item.tax ? item.tax + '%' : '-'}</td>
                        <td class="px-4 py-4">
                            <div class="flex gap-2 justify-center">
                                <button onclick="editItem(${index})" 
                                    class="bg-blue-500 text-white px-3 py-2 rounded-lg hover:bg-blue-600 transition text-sm font-semibold">
                                    ‚úèÔ∏è Edit
                                </button>
                                <button onclick="deleteItem(${index})" 
                                    class="bg-red-500 text-white px-3 py-2 rounded-lg hover:bg-red-600 transition text-sm font-semibold">
                                    üóëÔ∏è Hapus
                                </button>
                            </div>
                        </td>
                    </tr>
                `;
            });

            html += '</tbody></table>';
            container.innerHTML = html;
        }

        // Update statistics
        function updateStatistics(items) {
            document.getElementById('totalItems').textContent = items.length;
            
            if (items.length > 0) {
                const prices = items.map(item => item.price);
                const maxPrice = Math.max(...prices);
                const minPrice = Math.min(...prices);
                document.getElementById('maxPrice').textContent = 'Rp ' + maxPrice.toLocaleString('id-ID');
                document.getElementById('minPrice').textContent = 'Rp ' + minPrice.toLocaleString('id-ID');
            } else {
                document.getElementById('maxPrice').textContent = 'Rp 0';
                document.getElementById('minPrice').textContent = 'Rp 0';
            }
        }

        // Handle form submit
        document.getElementById('fruitForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const editIndex = document.getElementById('editIndex').value;
            const formData = new FormData();
            formData.append('name', document.getElementById('name').value);
            formData.append('price', document.getElementById('price').value);
            formData.append('description', document.getElementById('description').value || '');
            formData.append('tax', document.getElementById('tax').value || '0');

            try {
                if (editIndex !== '') {
                    // Update
                    await axios.put(`${API_URL}/items/update/select=${editIndex}`, formData);
                    showToast('‚úÖ Buah berhasil diupdate!');
                } else {
                    // Create
                    await axios.post(`${API_URL}/items`, formData);
                    showToast('‚úÖ Buah berhasil ditambahkan!');
                }
                resetForm();
                loadItems();
            } catch (error) {
                showToast('‚ùå Terjadi kesalahan: ' + error.message, true);
            }
        });

        // Edit item
        async function editItem(index) {
            try {
                const response = await axios.get(`${API_URL}/items/select=${index}`);
                const item = response.data;
                
                document.getElementById('name').value = item.name;
                document.getElementById('price').value = item.price;
                document.getElementById('description').value = item.description || '';
                document.getElementById('tax').value = item.tax || '';
                document.getElementById('editIndex').value = index;
                
                document.getElementById('formTitle').textContent = '‚úèÔ∏è Edit Buah';
                document.getElementById('submitBtn').textContent = 'Update Buah';
                document.getElementById('submitBtn').className = 'flex-1 bg-gradient-to-r from-blue-600 to-purple-500 text-white px-6 py-3 rounded-lg font-semibold hover:shadow-lg transform hover:-translate-y-0.5 transition';
                document.getElementById('cancelBtn').classList.remove('hidden');
                
                // Scroll to form
                window.scrollTo({ top: 0, behavior: 'smooth' });
            } catch (error) {
                showToast('‚ùå Gagal memuat data buah', true);
            }
        }

        // Delete item
        async function deleteItem(index) {
            if (!confirm('Yakin ingin menghapus buah ini?')) return;

            try {
                await axios.delete(`${API_URL}/items/delete/${index}`);
                showToast('üóëÔ∏è Buah berhasil dihapus!');
                loadItems();
            } catch (error) {
                showToast('‚ùå Terjadi kesalahan: ' + error.message, true);
            }
        }

        // Cancel edit
        function cancelEdit() {
            resetForm();
        }

        // Reset form
        function resetForm() {
            document.getElementById('fruitForm').reset();
            document.getElementById('editIndex').value = '';
            document.getElementById('formTitle').textContent = '‚ûï Tambah Buah';
            document.getElementById('submitBtn').textContent = 'Tambah Buah';
            document.getElementById('submitBtn').className = 'flex-1 bg-gradient-to-r from-green-600 to-yellow-500 text-white px-6 py-3 rounded-lg font-semibold hover:shadow-lg transform hover:-translate-y-0.5 transition';
            document.getElementById('cancelBtn').classList.add('hidden');
        }
    </script>
</body>
</html>